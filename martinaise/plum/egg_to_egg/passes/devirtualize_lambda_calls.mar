import mod.mar

fun devirtualize_lambda_calls(id: EggId, builder: &EggBodyBuilder): EggId {
  var call = id.resolve().call_lambda or return id

  if call.lambda.resolve() is raw_lambda(lambda) then {
    var args = list[EggId]()
    for arg in call.args do args.&.push(arg)
    args.&.push(lambda.closure)
    return builder.call(
      lambda.fun_,
      args.to_slice(),
      id.type(),
    )
  }

  id
}
